--- 
- name: "Register Redhat subscription"
  gather_facts: True
  hosts: all
  vars:
  - is_register: true
  - redhat_subscription_user: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33366538663535396331613737623465613766616564333638326332376563633161653538643538
          3031333932346537336634646138366362363139666232360a373062343133316335393238663839
          38396661366436326335393736363237323962353133336461366264636533303130616462316562
          3232643234666631340a313435313964393838366539623734333561306462383536633439393664
          3235
  - redhat_subscription_pwd: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34313631363163363331646336613134316238633638666162386462343064343637343931616639
          6239303366363239623336326534613835386331316530380a336334336437663334366133366165
          64333963643139633737326661316263633664633163653331656235363635616161326639646162
          6364613732376536390a643064666461663237393765323533383839393237356632376631643465
          37616639366465653862343961373965393163613564363631303638626133383035
  tasks:
    - name: Register Redhat subscription and attach automatically
      redhat_subscription:
        state: "{{ (is_register == True) | ternary('present', 'absent') }}"
        username: "{{redhat_subscription_user}}"
        password: "{{redhat_subscription_pwd}}"
        autosubscribe: true
        force_register: yes
